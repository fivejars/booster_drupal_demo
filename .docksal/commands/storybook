#!/usr/bin/env bash

#: exec_target = cli
# Abort if anything fails
set -e

echo "Storybook: Make use of modern versions of yarn."
if [[ -f .yarnrc.yml ]]; then
  rm .yarnrc.yml
fi
yarn set version berry

echo "Storybook: Avoid pnp"
echo 'nodeLinker: node-modules' >> .yarnrc.yml

echo "Storybook: Install"
if [[ -d node_modules ]]; then
  rm -rf node_modules
fi
if [[ -f yarn.lock ]]; then
  rm yarn.lock
fi
yarn install

echo "Storybook: Generate stories"
drush storybook:generate-all-stories --omit-server-url

echo "Storybook: Build"
yarn build-storybook

echo "Storybook: Cleanup autogenerated files"
rm -rf node_modules
rm .yarnrc.yml
rm yarn.lock
